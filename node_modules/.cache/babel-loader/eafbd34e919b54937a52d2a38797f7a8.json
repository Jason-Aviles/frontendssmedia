{"ast":null,"code":"import _asyncToGenerator from\"/Users/jasonaviles/Desktop/facebook/starter/frontendssmedia/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"/Users/jasonaviles/Desktop/facebook/starter/frontendssmedia/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/jasonaviles/Desktop/facebook/starter/frontendssmedia/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/jasonaviles/Desktop/facebook/starter/frontendssmedia/node_modules/@babel/runtime/regenerator/index.js\";import{useCallback,useEffect,useRef,useState}from\"react\";import Cropper from\"react-easy-crop\";import useClickOutside from\"../../helpers/clickOutside\";import getCroppedImg from\"../../helpers/getCroppedImg\";import{uploadImages}from\"../../functions/uploadImages\";import{useSelector}from\"react-redux\";import{updateCover}from\"../../functions/user\";import{createPost}from\"../../functions/post\";import PulseLoader from\"react-spinners/PulseLoader\";import OldCovers from\"./OldCovers\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Cover(_ref){var cover=_ref.cover,visitor=_ref.visitor,photos=_ref.photos;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showCoverMneu=_useState2[0],setShowCoverMenu=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),coverPicture=_useState4[0],setCoverPicture=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),show=_useState8[0],setShow=_useState8[1];var _useSelector=useSelector(function(state){return _objectSpread({},state);}),user=_useSelector.user;var menuRef=useRef(null);var refInput=useRef(null);var cRef=useRef(null);useClickOutside(menuRef,function(){return setShowCoverMenu(false);});var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),error=_useState10[0],setError=_useState10[1];var handleImage=function handleImage(e){var file=e.target.files[0];if(file.type!==\"image/jpeg\"&&file.type!==\"image/png\"&&file.type!==\"image/webp\"&&file.type!==\"image/gif\"){setError(\"\".concat(file.name,\" format is not supported.\"));setShowCoverMenu(false);return;}else if(file.size>1024*1024*5){setError(\"\".concat(file.name,\" is too large max 5mb allowed.\"));setShowCoverMenu(false);return;}var reader=new FileReader();reader.readAsDataURL(file);reader.onload=function(event){setCoverPicture(event.target.result);};};var _useState11=useState({x:0,y:0}),_useState12=_slicedToArray(_useState11,2),crop=_useState12[0],setCrop=_useState12[1];var _useState13=useState(1),_useState14=_slicedToArray(_useState13,2),zoom=_useState14[0],setZoom=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),croppedAreaPixels=_useState16[0],setCroppedAreaPixels=_useState16[1];var onCropComplete=useCallback(function(croppedArea,croppedAreaPixels){setCroppedAreaPixels(croppedAreaPixels);},[]);var getCroppedImage=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(show){var img;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getCroppedImg(coverPicture,croppedAreaPixels);case 3:img=_context.sent;if(!show){_context.next=10;break;}setZoom(1);setCrop({x:0,y:0});setCoverPicture(img);_context.next=11;break;case 10:return _context.abrupt(\"return\",img);case 11:_context.next=16;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 16:case\"end\":return _context.stop();}}},_callee,null,[[0,13]]);}));return function(_x){return _ref2.apply(this,arguments);};}(),[croppedAreaPixels]);var coverRef=useRef(null);var _useState17=useState(),_useState18=_slicedToArray(_useState17,2),width=_useState18[0],setWidth=_useState18[1];useEffect(function(){setWidth(coverRef.current.clientWidth);},[window.innerWidth]);var updateCoverPicture=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var img,blob,path,formData,res,updated_picture,new_post;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;setLoading(true);_context2.next=4;return getCroppedImage();case 4:img=_context2.sent;_context2.next=7;return fetch(img).then(function(b){return b.blob();});case 7:blob=_context2.sent;path=\"\".concat(user.username,\"/cover_pictures\");formData=new FormData();formData.append(\"file\",blob);formData.append(\"path\",path);_context2.next=14;return uploadImages(formData,path,user.token);case 14:res=_context2.sent;_context2.next=17;return updateCover(res[0].url,user.token);case 17:updated_picture=_context2.sent;if(!(updated_picture===\"ok\")){_context2.next=25;break;}_context2.next=21;return createPost(\"coverPicture\",null,null,res,user.id,user.token);case 21:new_post=_context2.sent;if(new_post.status===\"ok\"){setLoading(false);setCoverPicture(\"\");cRef.current.src=res[0].url;}else{setLoading(false);setError(new_post);}_context2.next=27;break;case 25:setLoading(false);setError(updated_picture);case 27:_context2.next=33;break;case 29:_context2.prev=29;_context2.t0=_context2[\"catch\"](0);setLoading(false);setError(_context2.t0.response.data.message);case 33:case\"end\":return _context2.stop();}}},_callee2,null,[[0,29]]);}));return function updateCoverPicture(){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"profile_cover\",ref:coverRef,children:[coverPicture&&/*#__PURE__*/_jsxs(\"div\",{className:\"save_changes_cover\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"save_changes_left\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"public_icon\"}),\"Your cover photo is public\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"save_changes_right\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"blue_btn opacity_btn\",onClick:function onClick(){return setCoverPicture(\"\");},children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{className:\"blue_btn \",onClick:function onClick(){return updateCoverPicture();},children:loading?/*#__PURE__*/_jsx(PulseLoader,{color:\"#fff\",size:5}):\"Save changes\"})]})]}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",ref:refInput,hidden:true,accept:\"image/jpeg,image/png,image/webp,image/gif\",onChange:handleImage}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"postError comment_error cover_error\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"postError_error\",children:error}),/*#__PURE__*/_jsx(\"button\",{className:\"blue_btn\",onClick:function onClick(){return setError(\"\");},children:\"Try again\"})]}),coverPicture&&/*#__PURE__*/_jsx(\"div\",{className:\"cover_crooper\",children:/*#__PURE__*/_jsx(Cropper,{image:coverPicture,crop:crop,zoom:zoom,aspect:width/350,onCropChange:setCrop,onCropComplete:onCropComplete,onZoomChange:setZoom,showGrid:true,objectFit:\"horizontal-cover\"})}),cover&&!coverPicture&&/*#__PURE__*/_jsx(\"img\",{src:cover,className:\"cover\",alt:\"\",ref:cRef}),!visitor&&/*#__PURE__*/_jsxs(\"div\",{className:\"udpate_cover_wrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"open_cover_update\",onClick:function onClick(){return setShowCoverMenu(function(prev){return!prev;});},children:[/*#__PURE__*/_jsx(\"i\",{className:\"camera_filled_icon\"}),\"Add Cover Photo\"]}),showCoverMneu&&/*#__PURE__*/_jsxs(\"div\",{className:\"open_cover_menu\",ref:menuRef,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"open_cover_menu_item hover1\",onClick:function onClick(){return setShow(true);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"photo_icon\"}),\"Select Photo\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"open_cover_menu_item hover1\",onClick:function onClick(){return refInput.current.click();},children:[/*#__PURE__*/_jsx(\"i\",{className:\"upload_icon\"}),\"Upload Photo\"]})]})]}),show&&/*#__PURE__*/_jsx(OldCovers,{photos:photos,setCoverPicture:setCoverPicture,setShow:setShow})]});}","map":{"version":3,"sources":["/Users/jasonaviles/Desktop/facebook/starter/frontendssmedia/src/pages/profile/Cover.js"],"names":["useCallback","useEffect","useRef","useState","Cropper","useClickOutside","getCroppedImg","uploadImages","useSelector","updateCover","createPost","PulseLoader","OldCovers","Cover","cover","visitor","photos","showCoverMneu","setShowCoverMenu","coverPicture","setCoverPicture","loading","setLoading","show","setShow","state","user","menuRef","refInput","cRef","error","setError","handleImage","e","file","target","files","type","name","size","reader","FileReader","readAsDataURL","onload","event","result","x","y","crop","setCrop","zoom","setZoom","croppedAreaPixels","setCroppedAreaPixels","onCropComplete","croppedArea","getCroppedImage","img","console","log","coverRef","width","setWidth","current","clientWidth","window","innerWidth","updateCoverPicture","fetch","then","b","blob","path","username","formData","FormData","append","token","res","url","updated_picture","id","new_post","status","src","response","data","message","prev","click"],"mappings":"skBAAA,OAASA,WAAT,CAAsBC,SAAtB,CAAiCC,MAAjC,CAAyCC,QAAzC,KAAyD,OAAzD,CACA,MAAOC,CAAAA,OAAP,KAAoB,iBAApB,CACA,MAAOC,CAAAA,eAAP,KAA4B,4BAA5B,CACA,MAAOC,CAAAA,aAAP,KAA0B,6BAA1B,CACA,OAASC,YAAT,KAA6B,8BAA7B,CACA,OAASC,WAAT,KAA4B,aAA5B,CACA,OAASC,WAAT,KAA4B,sBAA5B,CACA,OAASC,UAAT,KAA2B,sBAA3B,CACA,MAAOC,CAAAA,WAAP,KAAwB,4BAAxB,CACA,MAAOC,CAAAA,SAAP,KAAsB,aAAtB,C,wFAEA,cAAe,SAASC,CAAAA,KAAT,MAA2C,IAA1BC,CAAAA,KAA0B,MAA1BA,KAA0B,CAAnBC,OAAmB,MAAnBA,OAAmB,CAAVC,MAAU,MAAVA,MAAU,CACxD,cAA0Cb,QAAQ,CAAC,KAAD,CAAlD,wCAAOc,aAAP,eAAsBC,gBAAtB,eACA,eAAwCf,QAAQ,CAAC,EAAD,CAAhD,yCAAOgB,YAAP,eAAqBC,eAArB,eACA,eAA8BjB,QAAQ,CAAC,KAAD,CAAtC,yCAAOkB,OAAP,eAAgBC,UAAhB,eACA,eAAwBnB,QAAQ,CAAC,KAAD,CAAhC,yCAAOoB,IAAP,eAAaC,OAAb,eACA,iBAAiBhB,WAAW,CAAC,SAACiB,KAAD,0BAAiBA,KAAjB,GAAD,CAA5B,CAAQC,IAAR,cAAQA,IAAR,CACA,GAAMC,CAAAA,OAAO,CAAGzB,MAAM,CAAC,IAAD,CAAtB,CACA,GAAM0B,CAAAA,QAAQ,CAAG1B,MAAM,CAAC,IAAD,CAAvB,CACA,GAAM2B,CAAAA,IAAI,CAAG3B,MAAM,CAAC,IAAD,CAAnB,CACAG,eAAe,CAACsB,OAAD,CAAU,iBAAMT,CAAAA,gBAAgB,CAAC,KAAD,CAAtB,EAAV,CAAf,CACA,eAA0Bf,QAAQ,CAAC,EAAD,CAAlC,0CAAO2B,KAAP,gBAAcC,QAAd,gBACA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACC,CAAD,CAAO,CACzB,GAAIC,CAAAA,IAAI,CAAGD,CAAC,CAACE,MAAF,CAASC,KAAT,CAAe,CAAf,CAAX,CACA,GACEF,IAAI,CAACG,IAAL,GAAc,YAAd,EACAH,IAAI,CAACG,IAAL,GAAc,WADd,EAEAH,IAAI,CAACG,IAAL,GAAc,YAFd,EAGAH,IAAI,CAACG,IAAL,GAAc,WAJhB,CAKE,CACAN,QAAQ,WAAIG,IAAI,CAACI,IAAT,8BAAR,CACApB,gBAAgB,CAAC,KAAD,CAAhB,CACA,OACD,CATD,IASO,IAAIgB,IAAI,CAACK,IAAL,CAAY,KAAO,IAAP,CAAc,CAA9B,CAAiC,CACtCR,QAAQ,WAAIG,IAAI,CAACI,IAAT,mCAAR,CACApB,gBAAgB,CAAC,KAAD,CAAhB,CACA,OACD,CAED,GAAMsB,CAAAA,MAAM,CAAG,GAAIC,CAAAA,UAAJ,EAAf,CACAD,MAAM,CAACE,aAAP,CAAqBR,IAArB,EACAM,MAAM,CAACG,MAAP,CAAgB,SAACC,KAAD,CAAW,CACzBxB,eAAe,CAACwB,KAAK,CAACT,MAAN,CAAaU,MAAd,CAAf,CACD,CAFD,CAGD,CAtBD,CAuBA,gBAAwB1C,QAAQ,CAAC,CAAE2C,CAAC,CAAE,CAAL,CAAQC,CAAC,CAAE,CAAX,CAAD,CAAhC,2CAAOC,IAAP,gBAAaC,OAAb,gBACA,gBAAwB9C,QAAQ,CAAC,CAAD,CAAhC,2CAAO+C,IAAP,gBAAaC,OAAb,gBACA,gBAAkDhD,QAAQ,CAAC,IAAD,CAA1D,2CAAOiD,iBAAP,gBAA0BC,oBAA1B,gBACA,GAAMC,CAAAA,cAAc,CAAGtD,WAAW,CAAC,SAACuD,WAAD,CAAcH,iBAAd,CAAoC,CACrEC,oBAAoB,CAACD,iBAAD,CAApB,CACD,CAFiC,CAE/B,EAF+B,CAAlC,CAGA,GAAMI,CAAAA,eAAe,CAAGxD,WAAW,2FACjC,iBAAOuB,IAAP,gKAEsBjB,CAAAA,aAAa,CAACa,YAAD,CAAeiC,iBAAf,CAFnC,QAEUK,GAFV,mBAGQlC,IAHR,0BAIM4B,OAAO,CAAC,CAAD,CAAP,CACAF,OAAO,CAAC,CAAEH,CAAC,CAAE,CAAL,CAAQC,CAAC,CAAE,CAAX,CAAD,CAAP,CACA3B,eAAe,CAACqC,GAAD,CAAf,CANN,+DAQaA,GARb,2FAWIC,OAAO,CAACC,GAAR,cAXJ,qEADiC,gEAejC,CAACP,iBAAD,CAfiC,CAAnC,CAiBA,GAAMQ,CAAAA,QAAQ,CAAG1D,MAAM,CAAC,IAAD,CAAvB,CACA,gBAA0BC,QAAQ,EAAlC,2CAAO0D,KAAP,gBAAcC,QAAd,gBACA7D,SAAS,CAAC,UAAM,CACd6D,QAAQ,CAACF,QAAQ,CAACG,OAAT,CAAiBC,WAAlB,CAAR,CACD,CAFQ,CAEN,CAACC,MAAM,CAACC,UAAR,CAFM,CAAT,CAIA,GAAMC,CAAAA,kBAAkB,2FAAG,iNAEvB7C,UAAU,CAAC,IAAD,CAAV,CAFuB,uBAGPkC,CAAAA,eAAe,EAHR,QAGnBC,GAHmB,uCAINW,CAAAA,KAAK,CAACX,GAAD,CAAL,CAAWY,IAAX,CAAgB,SAACC,CAAD,QAAOA,CAAAA,CAAC,CAACC,IAAF,EAAP,EAAhB,CAJM,QAInBA,IAJmB,gBAKjBC,IALiB,WAKP9C,IAAI,CAAC+C,QALE,oBAMnBC,QANmB,CAMR,GAAIC,CAAAA,QAAJ,EANQ,CAOvBD,QAAQ,CAACE,MAAT,CAAgB,MAAhB,CAAwBL,IAAxB,EACAG,QAAQ,CAACE,MAAT,CAAgB,MAAhB,CAAwBJ,IAAxB,EARuB,wBASLjE,CAAAA,YAAY,CAACmE,QAAD,CAAWF,IAAX,CAAiB9C,IAAI,CAACmD,KAAtB,CATP,SASjBC,GATiB,wCAUOrE,CAAAA,WAAW,CAACqE,GAAG,CAAC,CAAD,CAAH,CAAOC,GAAR,CAAarD,IAAI,CAACmD,KAAlB,CAVlB,SAUjBG,eAViB,qBAWnBA,eAAe,GAAK,IAXD,oDAYEtE,CAAAA,UAAU,CAC/B,cAD+B,CAE/B,IAF+B,CAG/B,IAH+B,CAI/BoE,GAJ+B,CAK/BpD,IAAI,CAACuD,EAL0B,CAM/BvD,IAAI,CAACmD,KAN0B,CAZZ,SAYfK,QAZe,gBAoBrB,GAAIA,QAAQ,CAACC,MAAT,GAAoB,IAAxB,CAA8B,CAC5B7D,UAAU,CAAC,KAAD,CAAV,CACAF,eAAe,CAAC,EAAD,CAAf,CACAS,IAAI,CAACkC,OAAL,CAAaqB,GAAb,CAAmBN,GAAG,CAAC,CAAD,CAAH,CAAOC,GAA1B,CACD,CAJD,IAIO,CACLzD,UAAU,CAAC,KAAD,CAAV,CAEAS,QAAQ,CAACmD,QAAD,CAAR,CACD,CA5BoB,gCA8BrB5D,UAAU,CAAC,KAAD,CAAV,CAEAS,QAAQ,CAACiD,eAAD,CAAR,CAhCqB,6FAmCvB1D,UAAU,CAAC,KAAD,CAAV,CACAS,QAAQ,CAAC,aAAMsD,QAAN,CAAeC,IAAf,CAAoBC,OAArB,CAAR,CApCuB,uEAAH,kBAAlBpB,CAAAA,kBAAkB,2CAAxB,CAuCA,mBACE,aAAK,SAAS,CAAC,eAAf,CAA+B,GAAG,CAAEP,QAApC,WACGzC,YAAY,eACX,aAAK,SAAS,CAAC,oBAAf,wBACE,aAAK,SAAS,CAAC,mBAAf,wBACE,UAAG,SAAS,CAAC,aAAb,EADF,gCADF,cAKE,aAAK,SAAS,CAAC,oBAAf,wBACE,eACE,SAAS,CAAC,sBADZ,CAEE,OAAO,CAAE,yBAAMC,CAAAA,eAAe,CAAC,EAAD,CAArB,EAFX,oBADF,cAOE,eAAQ,SAAS,CAAC,WAAlB,CAA8B,OAAO,CAAE,yBAAM+C,CAAAA,kBAAkB,EAAxB,EAAvC,UACG9C,OAAO,cAAG,KAAC,WAAD,EAAa,KAAK,CAAC,MAAnB,CAA0B,IAAI,CAAE,CAAhC,EAAH,CAA2C,cADrD,EAPF,GALF,GAFJ,cAoBE,cACE,IAAI,CAAC,MADP,CAEE,GAAG,CAAEO,QAFP,CAGE,MAAM,KAHR,CAIE,MAAM,CAAC,2CAJT,CAKE,QAAQ,CAAEI,WALZ,EApBF,CA2BGF,KAAK,eACJ,aAAK,SAAS,CAAC,qCAAf,wBACE,YAAK,SAAS,CAAC,iBAAf,UAAkCA,KAAlC,EADF,cAEE,eAAQ,SAAS,CAAC,UAAlB,CAA6B,OAAO,CAAE,yBAAMC,CAAAA,QAAQ,CAAC,EAAD,CAAd,EAAtC,uBAFF,GA5BJ,CAmCGZ,YAAY,eACX,YAAK,SAAS,CAAC,eAAf,uBACE,KAAC,OAAD,EACE,KAAK,CAAEA,YADT,CAEE,IAAI,CAAE6B,IAFR,CAGE,IAAI,CAAEE,IAHR,CAIE,MAAM,CAAEW,KAAK,CAAG,GAJlB,CAKE,YAAY,CAAEZ,OALhB,CAME,cAAc,CAAEK,cANlB,CAOE,YAAY,CAAEH,OAPhB,CAQE,QAAQ,CAAE,IARZ,CASE,SAAS,CAAC,kBATZ,EADF,EApCJ,CAkDGrC,KAAK,EAAI,CAACK,YAAV,eACC,YAAK,GAAG,CAAEL,KAAV,CAAiB,SAAS,CAAC,OAA3B,CAAmC,GAAG,CAAC,EAAvC,CAA0C,GAAG,CAAEe,IAA/C,EAnDJ,CAqDG,CAACd,OAAD,eACC,aAAK,SAAS,CAAC,sBAAf,wBACE,aACE,SAAS,CAAC,mBADZ,CAEE,OAAO,CAAE,yBAAMG,CAAAA,gBAAgB,CAAC,SAACsE,IAAD,QAAU,CAACA,IAAX,EAAD,CAAtB,EAFX,wBAIE,UAAG,SAAS,CAAC,oBAAb,EAJF,qBADF,CAQGvE,aAAa,eACZ,aAAK,SAAS,CAAC,iBAAf,CAAiC,GAAG,CAAEU,OAAtC,wBACE,aACE,SAAS,CAAC,6BADZ,CAEE,OAAO,CAAE,yBAAMH,CAAAA,OAAO,CAAC,IAAD,CAAb,EAFX,wBAIE,UAAG,SAAS,CAAC,YAAb,EAJF,kBADF,cAQE,aACE,SAAS,CAAC,6BADZ,CAEE,OAAO,CAAE,yBAAMI,CAAAA,QAAQ,CAACmC,OAAT,CAAiB0B,KAAjB,EAAN,EAFX,wBAIE,UAAG,SAAS,CAAC,aAAb,EAJF,kBARF,GATJ,GAtDJ,CAkFGlE,IAAI,eACH,KAAC,SAAD,EACE,MAAM,CAAEP,MADV,CAEE,eAAe,CAAEI,eAFnB,CAGE,OAAO,CAAEI,OAHX,EAnFJ,GADF,CA4FD","sourcesContent":["import { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport Cropper from \"react-easy-crop\";\r\nimport useClickOutside from \"../../helpers/clickOutside\";\r\nimport getCroppedImg from \"../../helpers/getCroppedImg\";\r\nimport { uploadImages } from \"../../functions/uploadImages\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { updateCover } from \"../../functions/user\";\r\nimport { createPost } from \"../../functions/post\";\r\nimport PulseLoader from \"react-spinners/PulseLoader\";\r\nimport OldCovers from \"./OldCovers\";\r\n\r\nexport default function Cover({ cover, visitor, photos }) {\r\n  const [showCoverMneu, setShowCoverMenu] = useState(false);\r\n  const [coverPicture, setCoverPicture] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [show, setShow] = useState(false);\r\n  const { user } = useSelector((state) => ({ ...state }));\r\n  const menuRef = useRef(null);\r\n  const refInput = useRef(null);\r\n  const cRef = useRef(null);\r\n  useClickOutside(menuRef, () => setShowCoverMenu(false));\r\n  const [error, setError] = useState(\"\");\r\n  const handleImage = (e) => {\r\n    let file = e.target.files[0];\r\n    if (\r\n      file.type !== \"image/jpeg\" &&\r\n      file.type !== \"image/png\" &&\r\n      file.type !== \"image/webp\" &&\r\n      file.type !== \"image/gif\"\r\n    ) {\r\n      setError(`${file.name} format is not supported.`);\r\n      setShowCoverMenu(false);\r\n      return;\r\n    } else if (file.size > 1024 * 1024 * 5) {\r\n      setError(`${file.name} is too large max 5mb allowed.`);\r\n      setShowCoverMenu(false);\r\n      return;\r\n    }\r\n\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(file);\r\n    reader.onload = (event) => {\r\n      setCoverPicture(event.target.result);\r\n    };\r\n  };\r\n  const [crop, setCrop] = useState({ x: 0, y: 0 });\r\n  const [zoom, setZoom] = useState(1);\r\n  const [croppedAreaPixels, setCroppedAreaPixels] = useState(null);\r\n  const onCropComplete = useCallback((croppedArea, croppedAreaPixels) => {\r\n    setCroppedAreaPixels(croppedAreaPixels);\r\n  }, []);\r\n  const getCroppedImage = useCallback(\r\n    async (show) => {\r\n      try {\r\n        const img = await getCroppedImg(coverPicture, croppedAreaPixels);\r\n        if (show) {\r\n          setZoom(1);\r\n          setCrop({ x: 0, y: 0 });\r\n          setCoverPicture(img);\r\n        } else {\r\n          return img;\r\n        }\r\n      } catch (error) {\r\n        console.log(error);\r\n      }\r\n    },\r\n    [croppedAreaPixels]\r\n  );\r\n  const coverRef = useRef(null);\r\n  const [width, setWidth] = useState();\r\n  useEffect(() => {\r\n    setWidth(coverRef.current.clientWidth);\r\n  }, [window.innerWidth]);\r\n\r\n  const updateCoverPicture = async () => {\r\n    try {\r\n      setLoading(true);\r\n      let img = await getCroppedImage();\r\n      let blob = await fetch(img).then((b) => b.blob());\r\n      const path = `${user.username}/cover_pictures`;\r\n      let formData = new FormData();\r\n      formData.append(\"file\", blob);\r\n      formData.append(\"path\", path);\r\n      const res = await uploadImages(formData, path, user.token);\r\n      const updated_picture = await updateCover(res[0].url, user.token);\r\n      if (updated_picture === \"ok\") {\r\n        const new_post = await createPost(\r\n          \"coverPicture\",\r\n          null,\r\n          null,\r\n          res,\r\n          user.id,\r\n          user.token\r\n        );\r\n        if (new_post.status === \"ok\") {\r\n          setLoading(false);\r\n          setCoverPicture(\"\");\r\n          cRef.current.src = res[0].url;\r\n        } else {\r\n          setLoading(false);\r\n\r\n          setError(new_post);\r\n        }\r\n      } else {\r\n        setLoading(false);\r\n\r\n        setError(updated_picture);\r\n      }\r\n    } catch (error) {\r\n      setLoading(false);\r\n      setError(error.response.data.message);\r\n    }\r\n  };\r\n  return (\r\n    <div className=\"profile_cover\" ref={coverRef}>\r\n      {coverPicture && (\r\n        <div className=\"save_changes_cover\">\r\n          <div className=\"save_changes_left\">\r\n            <i className=\"public_icon\"></i>\r\n            Your cover photo is public\r\n          </div>\r\n          <div className=\"save_changes_right\">\r\n            <button\r\n              className=\"blue_btn opacity_btn\"\r\n              onClick={() => setCoverPicture(\"\")}\r\n            >\r\n              Cancel\r\n            </button>\r\n            <button className=\"blue_btn \" onClick={() => updateCoverPicture()}>\r\n              {loading ? <PulseLoader color=\"#fff\" size={5} /> : \"Save changes\"}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      <input\r\n        type=\"file\"\r\n        ref={refInput}\r\n        hidden\r\n        accept=\"image/jpeg,image/png,image/webp,image/gif\"\r\n        onChange={handleImage}\r\n      />\r\n      {error && (\r\n        <div className=\"postError comment_error cover_error\">\r\n          <div className=\"postError_error\">{error}</div>\r\n          <button className=\"blue_btn\" onClick={() => setError(\"\")}>\r\n            Try again\r\n          </button>\r\n        </div>\r\n      )}\r\n      {coverPicture && (\r\n        <div className=\"cover_crooper\">\r\n          <Cropper\r\n            image={coverPicture}\r\n            crop={crop}\r\n            zoom={zoom}\r\n            aspect={width / 350}\r\n            onCropChange={setCrop}\r\n            onCropComplete={onCropComplete}\r\n            onZoomChange={setZoom}\r\n            showGrid={true}\r\n            objectFit=\"horizontal-cover\"\r\n          />\r\n        </div>\r\n      )}\r\n      {cover && !coverPicture && (\r\n        <img src={cover} className=\"cover\" alt=\"\" ref={cRef} />\r\n      )}\r\n      {!visitor && (\r\n        <div className=\"udpate_cover_wrapper\">\r\n          <div\r\n            className=\"open_cover_update\"\r\n            onClick={() => setShowCoverMenu((prev) => !prev)}\r\n          >\r\n            <i className=\"camera_filled_icon\"></i>\r\n            Add Cover Photo\r\n          </div>\r\n          {showCoverMneu && (\r\n            <div className=\"open_cover_menu\" ref={menuRef}>\r\n              <div\r\n                className=\"open_cover_menu_item hover1\"\r\n                onClick={() => setShow(true)}\r\n              >\r\n                <i className=\"photo_icon\"></i>\r\n                Select Photo\r\n              </div>\r\n              <div\r\n                className=\"open_cover_menu_item hover1\"\r\n                onClick={() => refInput.current.click()}\r\n              >\r\n                <i className=\"upload_icon\"></i>\r\n                Upload Photo\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n      {show && (\r\n        <OldCovers\r\n          photos={photos}\r\n          setCoverPicture={setCoverPicture}\r\n          setShow={setShow}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}