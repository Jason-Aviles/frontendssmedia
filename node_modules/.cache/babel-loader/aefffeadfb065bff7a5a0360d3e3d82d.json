{"ast":null,"code":"import _toConsumableArray from\"/Users/jasonaviles/Desktop/facebook/starter/frontendssmedia/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/jasonaviles/Desktop/facebook/starter/frontendssmedia/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/jasonaviles/Desktop/facebook/starter/frontendssmedia/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/jasonaviles/Desktop/facebook/starter/frontendssmedia/node_modules/@babel/runtime/regenerator/index.js\";import{useEffect,useRef,useState}from\"react\";import\"./style.css\";import Picker from\"emoji-picker-react\";import EmojiPickerBackgrounds from\"./EmojiPickerBackgrounds\";import AddToYourPost from\"./AddToYourPost\";import ImagePreview from\"./ImagePreview\";import useClickOutside from\"../../helpers/clickOutside\";import{createPost}from\"../../functions/post\";import PulseLoader from\"react-spinners/PulseLoader\";import{useDispatch}from\"react-redux\";import PostError from\"./PostError\";import dataURItoBlob from\"../../helpers/dataURItoBlob\";import{uploadImages}from\"../../functions/uploadImages\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function CreatePostPopup(_ref){var user=_ref.user,setVisible=_ref.setVisible,posts=_ref.posts,dispatch=_ref.dispatch,profile=_ref.profile;var popup=useRef(null);var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),text=_useState2[0],setText=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showPrev=_useState4[0],setShowPrev=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),images=_useState10[0],setImages=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),background=_useState12[0],setBackground=_useState12[1];useClickOutside(popup,function(){setVisible(false);});var postSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,postImages,path,formData,_response,res,_response2;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!background){_context.next=9;break;}setLoading(true);_context.next=4;return createPost(null,background,text,null,user.id,user.token);case 4:response=_context.sent;setLoading(false);if(response.status===\"ok\"){dispatch({type:profile?\"PROFILE_POSTS\":\"POSTS_SUCCESS\",payload:[response.data].concat(_toConsumableArray(posts))});setBackground(\"\");setText(\"\");setVisible(false);}else{setError(response);}_context.next=36;break;case 9:if(!(images&&images.length)){_context.next=26;break;}setLoading(true);postImages=images.map(function(img){return dataURItoBlob(img);});path=\"\".concat(user.username,\"/post_images\");formData=new FormData();formData.append(\"path\",path);postImages.forEach(function(image){formData.append(\"file\",image);});_context.next=18;return uploadImages(formData,path,user.token);case 18:_response=_context.sent;_context.next=21;return createPost(null,null,text,_response,user.id,user.token);case 21:res=_context.sent;setLoading(false);if(res.status===\"ok\"){dispatch({type:profile?\"PROFILE_POSTS\":\"POSTS_SUCCESS\",payload:[res.data].concat(_toConsumableArray(posts))});setText(\"\");setImages(\"\");setVisible(false);}else{setError(res);}_context.next=36;break;case 26:if(!text){_context.next=35;break;}setLoading(true);_context.next=30;return createPost(null,null,text,null,user.id,user.token);case 30:_response2=_context.sent;setLoading(false);if(_response2.status===\"ok\"){dispatch({type:profile?\"PROFILE_POSTS\":\"POSTS_SUCCESS\",payload:[_response2.data].concat(_toConsumableArray(posts))});setBackground(\"\");setText(\"\");setVisible(false);}else{setError(_response2);}_context.next=36;break;case 35:console.log(\"nothing\");case 36:case\"end\":return _context.stop();}}},_callee);}));return function postSubmit(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"blur\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"postBox\",ref:popup,children:[error&&/*#__PURE__*/_jsx(PostError,{error:error,setError:setError}),/*#__PURE__*/_jsxs(\"div\",{className:\"box_header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"small_circle\",onClick:function onClick(){setVisible(false);},children:/*#__PURE__*/_jsx(\"i\",{className:\"exit_icon\"})}),/*#__PURE__*/_jsx(\"span\",{children:\"Create Post\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"box_profile\",children:[/*#__PURE__*/_jsx(\"img\",{src:user.picture,alt:\"\",className:\"box_profile_img\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"box_col\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"box_profile_name\",children:[user.first_name,\" \",user.last_name]}),/*#__PURE__*/_jsxs(\"div\",{className:\"box_privacy\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"../../../icons/public.png\",alt:\"\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Public\"}),/*#__PURE__*/_jsx(\"i\",{className:\"arrowDown_icon\"})]})]})]}),!showPrev?/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(EmojiPickerBackgrounds,{text:text,user:user,setText:setText,showPrev:showPrev,setBackground:setBackground,background:background})}):/*#__PURE__*/_jsx(ImagePreview,{text:text,user:user,setText:setText,showPrev:showPrev,images:images,setImages:setImages,setShowPrev:setShowPrev,setError:setError}),/*#__PURE__*/_jsx(AddToYourPost,{setShowPrev:setShowPrev}),/*#__PURE__*/_jsx(\"button\",{className:\"post_submit\",onClick:function onClick(){postSubmit();},disabled:loading,children:loading?/*#__PURE__*/_jsx(PulseLoader,{color:\"#fff\",size:5}):\"Post\"})]})});}","map":{"version":3,"sources":["/Users/jasonaviles/Desktop/facebook/starter/frontendssmedia/src/components/createPostPopup/index.js"],"names":["useEffect","useRef","useState","Picker","EmojiPickerBackgrounds","AddToYourPost","ImagePreview","useClickOutside","createPost","PulseLoader","useDispatch","PostError","dataURItoBlob","uploadImages","CreatePostPopup","user","setVisible","posts","dispatch","profile","popup","text","setText","showPrev","setShowPrev","loading","setLoading","error","setError","images","setImages","background","setBackground","postSubmit","id","token","response","status","type","payload","data","length","postImages","map","img","path","username","formData","FormData","append","forEach","image","res","console","log","picture","first_name","last_name"],"mappings":"+kBAAA,OAASA,SAAT,CAAoBC,MAApB,CAA4BC,QAA5B,KAA4C,OAA5C,CACA,MAAO,aAAP,CACA,MAAOC,CAAAA,MAAP,KAAmB,oBAAnB,CACA,MAAOC,CAAAA,sBAAP,KAAmC,0BAAnC,CACA,MAAOC,CAAAA,aAAP,KAA0B,iBAA1B,CACA,MAAOC,CAAAA,YAAP,KAAyB,gBAAzB,CACA,MAAOC,CAAAA,eAAP,KAA4B,4BAA5B,CACA,OAASC,UAAT,KAA2B,sBAA3B,CACA,MAAOC,CAAAA,WAAP,KAAwB,4BAAxB,CACA,OAASC,WAAT,KAA4B,aAA5B,CACA,MAAOC,CAAAA,SAAP,KAAsB,aAAtB,CACA,MAAOC,CAAAA,aAAP,KAA0B,6BAA1B,CACA,OAASC,YAAT,KAA6B,8BAA7B,C,6IACA,cAAe,SAASC,CAAAA,eAAT,MAMZ,IALDC,CAAAA,IAKC,MALDA,IAKC,CAJDC,UAIC,MAJDA,UAIC,CAHDC,KAGC,MAHDA,KAGC,CAFDC,QAEC,MAFDA,QAEC,CADDC,OACC,MADDA,OACC,CACD,GAAMC,CAAAA,KAAK,CAAGnB,MAAM,CAAC,IAAD,CAApB,CACA,cAAwBC,QAAQ,CAAC,EAAD,CAAhC,wCAAOmB,IAAP,eAAaC,OAAb,eACA,eAAgCpB,QAAQ,CAAC,KAAD,CAAxC,yCAAOqB,QAAP,eAAiBC,WAAjB,eACA,eAA8BtB,QAAQ,CAAC,KAAD,CAAtC,yCAAOuB,OAAP,eAAgBC,UAAhB,eACA,eAA0BxB,QAAQ,CAAC,EAAD,CAAlC,yCAAOyB,KAAP,eAAcC,QAAd,eACA,eAA4B1B,QAAQ,CAAC,EAAD,CAApC,0CAAO2B,MAAP,gBAAeC,SAAf,gBACA,gBAAoC5B,QAAQ,CAAC,EAAD,CAA5C,2CAAO6B,UAAP,gBAAmBC,aAAnB,gBACAzB,eAAe,CAACa,KAAD,CAAQ,UAAM,CAC3BJ,UAAU,CAAC,KAAD,CAAV,CACD,CAFc,CAAf,CAGA,GAAMiB,CAAAA,UAAU,2FAAG,sMACbF,UADa,yBAEfL,UAAU,CAAC,IAAD,CAAV,CAFe,sBAGQlB,CAAAA,UAAU,CAC/B,IAD+B,CAE/BuB,UAF+B,CAG/BV,IAH+B,CAI/B,IAJ+B,CAK/BN,IAAI,CAACmB,EAL0B,CAM/BnB,IAAI,CAACoB,KAN0B,CAHlB,QAGTC,QAHS,eAWfV,UAAU,CAAC,KAAD,CAAV,CACA,GAAIU,QAAQ,CAACC,MAAT,GAAoB,IAAxB,CAA8B,CAC5BnB,QAAQ,CAAC,CACPoB,IAAI,CAAEnB,OAAO,CAAG,eAAH,CAAqB,eAD3B,CAEPoB,OAAO,EAAGH,QAAQ,CAACI,IAAZ,4BAAqBvB,KAArB,EAFA,CAAD,CAAR,CAIAe,aAAa,CAAC,EAAD,CAAb,CACAV,OAAO,CAAC,EAAD,CAAP,CACAN,UAAU,CAAC,KAAD,CAAV,CACD,CARD,IAQO,CACLY,QAAQ,CAACQ,QAAD,CAAR,CACD,CAtBc,mCAuBNP,MAAM,EAAIA,MAAM,CAACY,MAvBX,2BAwBff,UAAU,CAAC,IAAD,CAAV,CACMgB,UAzBS,CAyBIb,MAAM,CAACc,GAAP,CAAW,SAACC,GAAD,CAAS,CACrC,MAAOhC,CAAAA,aAAa,CAACgC,GAAD,CAApB,CACD,CAFkB,CAzBJ,CA4BTC,IA5BS,WA4BC9B,IAAI,CAAC+B,QA5BN,iBA6BXC,QA7BW,CA6BA,GAAIC,CAAAA,QAAJ,EA7BA,CA8BfD,QAAQ,CAACE,MAAT,CAAgB,MAAhB,CAAwBJ,IAAxB,EACAH,UAAU,CAACQ,OAAX,CAAmB,SAACC,KAAD,CAAW,CAC5BJ,QAAQ,CAACE,MAAT,CAAgB,MAAhB,CAAwBE,KAAxB,EACD,CAFD,EA/Be,uBAkCQtC,CAAAA,YAAY,CAACkC,QAAD,CAAWF,IAAX,CAAiB9B,IAAI,CAACoB,KAAtB,CAlCpB,SAkCTC,SAlCS,sCAoCG5B,CAAAA,UAAU,CAC1B,IAD0B,CAE1B,IAF0B,CAG1Ba,IAH0B,CAI1Be,SAJ0B,CAK1BrB,IAAI,CAACmB,EALqB,CAM1BnB,IAAI,CAACoB,KANqB,CApCb,SAoCTiB,GApCS,eA4Cf1B,UAAU,CAAC,KAAD,CAAV,CACA,GAAI0B,GAAG,CAACf,MAAJ,GAAe,IAAnB,CAAyB,CACvBnB,QAAQ,CAAC,CACPoB,IAAI,CAAEnB,OAAO,CAAG,eAAH,CAAqB,eAD3B,CAEPoB,OAAO,EAAGa,GAAG,CAACZ,IAAP,4BAAgBvB,KAAhB,EAFA,CAAD,CAAR,CAIAK,OAAO,CAAC,EAAD,CAAP,CACAQ,SAAS,CAAC,EAAD,CAAT,CACAd,UAAU,CAAC,KAAD,CAAV,CACD,CARD,IAQO,CACLY,QAAQ,CAACwB,GAAD,CAAR,CACD,CAvDc,mCAwDN/B,IAxDM,0BAyDfK,UAAU,CAAC,IAAD,CAAV,CAzDe,uBA0DQlB,CAAAA,UAAU,CAC/B,IAD+B,CAE/B,IAF+B,CAG/Ba,IAH+B,CAI/B,IAJ+B,CAK/BN,IAAI,CAACmB,EAL0B,CAM/BnB,IAAI,CAACoB,KAN0B,CA1DlB,SA0DTC,UA1DS,eAkEfV,UAAU,CAAC,KAAD,CAAV,CACA,GAAIU,UAAQ,CAACC,MAAT,GAAoB,IAAxB,CAA8B,CAC5BnB,QAAQ,CAAC,CACPoB,IAAI,CAAEnB,OAAO,CAAG,eAAH,CAAqB,eAD3B,CAEPoB,OAAO,EAAGH,UAAQ,CAACI,IAAZ,4BAAqBvB,KAArB,EAFA,CAAD,CAAR,CAIAe,aAAa,CAAC,EAAD,CAAb,CACAV,OAAO,CAAC,EAAD,CAAP,CACAN,UAAU,CAAC,KAAD,CAAV,CACD,CARD,IAQO,CACLY,QAAQ,CAACQ,UAAD,CAAR,CACD,CA7Ec,+BA+EfiB,OAAO,CAACC,GAAR,CAAY,SAAZ,EA/Ee,uDAAH,kBAAVrB,CAAAA,UAAU,2CAAhB,CAkFA,mBACE,YAAK,SAAS,CAAC,MAAf,uBACE,aAAK,SAAS,CAAC,SAAf,CAAyB,GAAG,CAAEb,KAA9B,WACGO,KAAK,eAAI,KAAC,SAAD,EAAW,KAAK,CAAEA,KAAlB,CAAyB,QAAQ,CAAEC,QAAnC,EADZ,cAEE,aAAK,SAAS,CAAC,YAAf,wBACE,YACE,SAAS,CAAC,cADZ,CAEE,OAAO,CAAE,kBAAM,CACbZ,UAAU,CAAC,KAAD,CAAV,CACD,CAJH,uBAME,UAAG,SAAS,CAAC,WAAb,EANF,EADF,cASE,qCATF,GAFF,cAaE,aAAK,SAAS,CAAC,aAAf,wBACE,YAAK,GAAG,CAAED,IAAI,CAACwC,OAAf,CAAwB,GAAG,CAAC,EAA5B,CAA+B,SAAS,CAAC,iBAAzC,EADF,cAEE,aAAK,SAAS,CAAC,SAAf,wBACE,aAAK,SAAS,CAAC,kBAAf,WACGxC,IAAI,CAACyC,UADR,KACqBzC,IAAI,CAAC0C,SAD1B,GADF,cAIE,aAAK,SAAS,CAAC,aAAf,wBACE,YAAK,GAAG,CAAC,2BAAT,CAAqC,GAAG,CAAC,EAAzC,EADF,cAEE,gCAFF,cAGE,UAAG,SAAS,CAAC,gBAAb,EAHF,GAJF,GAFF,GAbF,CA2BG,CAAClC,QAAD,cACC,sCACE,KAAC,sBAAD,EACE,IAAI,CAAEF,IADR,CAEE,IAAI,CAAEN,IAFR,CAGE,OAAO,CAAEO,OAHX,CAIE,QAAQ,CAAEC,QAJZ,CAKE,aAAa,CAAES,aALjB,CAME,UAAU,CAAED,UANd,EADF,EADD,cAYC,KAAC,YAAD,EACE,IAAI,CAAEV,IADR,CAEE,IAAI,CAAEN,IAFR,CAGE,OAAO,CAAEO,OAHX,CAIE,QAAQ,CAAEC,QAJZ,CAKE,MAAM,CAAEM,MALV,CAME,SAAS,CAAEC,SANb,CAOE,WAAW,CAAEN,WAPf,CAQE,QAAQ,CAAEI,QARZ,EAvCJ,cAkDE,KAAC,aAAD,EAAe,WAAW,CAAEJ,WAA5B,EAlDF,cAmDE,eACE,SAAS,CAAC,aADZ,CAEE,OAAO,CAAE,kBAAM,CACbS,UAAU,GACX,CAJH,CAKE,QAAQ,CAAER,OALZ,UAOGA,OAAO,cAAG,KAAC,WAAD,EAAa,KAAK,CAAC,MAAnB,CAA0B,IAAI,CAAE,CAAhC,EAAH,CAA2C,MAPrD,EAnDF,GADF,EADF,CAiED","sourcesContent":["import { useEffect, useRef, useState } from \"react\";\r\nimport \"./style.css\";\r\nimport Picker from \"emoji-picker-react\";\r\nimport EmojiPickerBackgrounds from \"./EmojiPickerBackgrounds\";\r\nimport AddToYourPost from \"./AddToYourPost\";\r\nimport ImagePreview from \"./ImagePreview\";\r\nimport useClickOutside from \"../../helpers/clickOutside\";\r\nimport { createPost } from \"../../functions/post\";\r\nimport PulseLoader from \"react-spinners/PulseLoader\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport PostError from \"./PostError\";\r\nimport dataURItoBlob from \"../../helpers/dataURItoBlob\";\r\nimport { uploadImages } from \"../../functions/uploadImages\";\r\nexport default function CreatePostPopup({\r\n  user,\r\n  setVisible,\r\n  posts,\r\n  dispatch,\r\n  profile,\r\n}) {\r\n  const popup = useRef(null);\r\n  const [text, setText] = useState(\"\");\r\n  const [showPrev, setShowPrev] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [images, setImages] = useState([]);\r\n  const [background, setBackground] = useState(\"\");\r\n  useClickOutside(popup, () => {\r\n    setVisible(false);\r\n  });\r\n  const postSubmit = async () => {\r\n    if (background) {\r\n      setLoading(true);\r\n      const response = await createPost(\r\n        null,\r\n        background,\r\n        text,\r\n        null,\r\n        user.id,\r\n        user.token\r\n      );\r\n      setLoading(false);\r\n      if (response.status === \"ok\") {\r\n        dispatch({\r\n          type: profile ? \"PROFILE_POSTS\" : \"POSTS_SUCCESS\",\r\n          payload: [response.data, ...posts],\r\n        });\r\n        setBackground(\"\");\r\n        setText(\"\");\r\n        setVisible(false);\r\n      } else {\r\n        setError(response);\r\n      }\r\n    } else if (images && images.length) {\r\n      setLoading(true);\r\n      const postImages = images.map((img) => {\r\n        return dataURItoBlob(img);\r\n      });\r\n      const path = `${user.username}/post_images`;\r\n      let formData = new FormData();\r\n      formData.append(\"path\", path);\r\n      postImages.forEach((image) => {\r\n        formData.append(\"file\", image);\r\n      });\r\n      const response = await uploadImages(formData, path, user.token);\r\n\r\n      const res = await createPost(\r\n        null,\r\n        null,\r\n        text,\r\n        response,\r\n        user.id,\r\n        user.token\r\n      );\r\n      setLoading(false);\r\n      if (res.status === \"ok\") {\r\n        dispatch({\r\n          type: profile ? \"PROFILE_POSTS\" : \"POSTS_SUCCESS\",\r\n          payload: [res.data, ...posts],\r\n        });\r\n        setText(\"\");\r\n        setImages(\"\");\r\n        setVisible(false);\r\n      } else {\r\n        setError(res);\r\n      }\r\n    } else if (text) {\r\n      setLoading(true);\r\n      const response = await createPost(\r\n        null,\r\n        null,\r\n        text,\r\n        null,\r\n        user.id,\r\n        user.token\r\n      );\r\n      setLoading(false);\r\n      if (response.status === \"ok\") {\r\n        dispatch({\r\n          type: profile ? \"PROFILE_POSTS\" : \"POSTS_SUCCESS\",\r\n          payload: [response.data, ...posts],\r\n        });\r\n        setBackground(\"\");\r\n        setText(\"\");\r\n        setVisible(false);\r\n      } else {\r\n        setError(response);\r\n      }\r\n    } else {\r\n      console.log(\"nothing\");\r\n    }\r\n  };\r\n  return (\r\n    <div className=\"blur\">\r\n      <div className=\"postBox\" ref={popup}>\r\n        {error && <PostError error={error} setError={setError} />}\r\n        <div className=\"box_header\">\r\n          <div\r\n            className=\"small_circle\"\r\n            onClick={() => {\r\n              setVisible(false);\r\n            }}\r\n          >\r\n            <i className=\"exit_icon\"></i>\r\n          </div>\r\n          <span>Create Post</span>\r\n        </div>\r\n        <div className=\"box_profile\">\r\n          <img src={user.picture} alt=\"\" className=\"box_profile_img\" />\r\n          <div className=\"box_col\">\r\n            <div className=\"box_profile_name\">\r\n              {user.first_name} {user.last_name}\r\n            </div>\r\n            <div className=\"box_privacy\">\r\n              <img src=\"../../../icons/public.png\" alt=\"\" />\r\n              <span>Public</span>\r\n              <i className=\"arrowDown_icon\"></i>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {!showPrev ? (\r\n          <>\r\n            <EmojiPickerBackgrounds\r\n              text={text}\r\n              user={user}\r\n              setText={setText}\r\n              showPrev={showPrev}\r\n              setBackground={setBackground}\r\n              background={background}\r\n            />\r\n          </>\r\n        ) : (\r\n          <ImagePreview\r\n            text={text}\r\n            user={user}\r\n            setText={setText}\r\n            showPrev={showPrev}\r\n            images={images}\r\n            setImages={setImages}\r\n            setShowPrev={setShowPrev}\r\n            setError={setError}\r\n          />\r\n        )}\r\n        <AddToYourPost setShowPrev={setShowPrev} />\r\n        <button\r\n          className=\"post_submit\"\r\n          onClick={() => {\r\n            postSubmit();\r\n          }}\r\n          disabled={loading}\r\n        >\r\n          {loading ? <PulseLoader color=\"#fff\" size={5} /> : \"Post\"}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}