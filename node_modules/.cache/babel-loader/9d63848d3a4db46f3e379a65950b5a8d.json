{"ast":null,"code":"import _asyncToGenerator from\"/Users/jasonaviles/Desktop/facebook/starter/frontendssmedia/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/jasonaviles/Desktop/facebook/starter/frontendssmedia/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/jasonaviles/Desktop/facebook/starter/frontendssmedia/node_modules/@babel/runtime/regenerator/index.js\";import{useEffect,useRef,useState}from\"react\";import Picker from\"emoji-picker-react\";import{comment}from\"../../functions/post\";import{uploadImages}from\"../../functions/uploadImages\";import dataURItoBlob from\"../../helpers/dataURItoBlob\";import{ClipLoader}from\"react-spinners\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function CreateComment(_ref){var user=_ref.user,postId=_ref.postId,setComments=_ref.setComments,setCount=_ref.setCount;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),picker=_useState2[0],setPicker=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),text=_useState4[0],setText=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),commentImage=_useState8[0],setCommentImage=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),cursorPosition=_useState10[0],setCursorPosition=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),loading=_useState12[0],setLoading=_useState12[1];var textRef=useRef(null);var imgInput=useRef(null);useEffect(function(){textRef.current.selectionEnd=cursorPosition;},[cursorPosition]);var handleEmoji=function handleEmoji(e,_ref2){var emoji=_ref2.emoji;var ref=textRef.current;ref.focus();var start=text.substring(0,ref.selectionStart);var end=text.substring(ref.selectionStart);var newText=start+emoji+end;setText(newText);setCursorPosition(start.length+emoji.length);};var handleImage=function handleImage(e){var file=e.target.files[0];if(file.type!==\"image/jpeg\"&&file.type!==\"image/png\"&&file.type!==\"image/webp\"&&file.type!==\"image/gif\"){setError(\"\".concat(file.name,\" format is not supported.\"));return;}else if(file.size>1024*1024*5){setError(\"\".concat(file.name,\" is too large max 5mb allowed.\"));return;}var reader=new FileReader();reader.readAsDataURL(file);reader.onload=function(event){setCommentImage(event.target.result);};};var handleComment=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var img,path,formData,imgComment,comments,_comments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(e.key===\"Enter\")){_context.next=30;break;}if(!(commentImage!=\"\")){_context.next=21;break;}setLoading(true);img=dataURItoBlob(commentImage);path=\"\".concat(user.username,\"/post_images/\").concat(postId);formData=new FormData();formData.append(\"path\",path);formData.append(\"file\",img);_context.next=10;return uploadImages(formData,path,user.token);case 10:imgComment=_context.sent;_context.next=13;return comment(postId,text,imgComment[0].url,user.token);case 13:comments=_context.sent;setComments(comments);setCount(function(prev){return++prev;});setLoading(false);setText(\"\");setCommentImage(\"\");_context.next=30;break;case 21:setLoading(true);_context.next=24;return comment(postId,text,\"\",user.token);case 24:_comments=_context.sent;setComments(_comments);setCount(function(prev){return++prev;});setLoading(false);setText(\"\");setCommentImage(\"\");case 30:case\"end\":return _context.stop();}}},_callee);}));return function handleComment(_x){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"create_comment_wrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"create_comment\",children:[/*#__PURE__*/_jsx(\"img\",{src:user===null||user===void 0?void 0:user.picture,alt:\"\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"comment_input_wrap\",children:[picker&&/*#__PURE__*/_jsx(\"div\",{className:\"comment_emoji_picker\",children:/*#__PURE__*/_jsx(Picker,{onEmojiClick:handleEmoji})}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",hidden:true,ref:imgInput,accept:\"image/jpeg,image/png,image/gif,image/webp\",onChange:handleImage}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"postError comment_error\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"postError_error\",children:error}),/*#__PURE__*/_jsx(\"button\",{className:\"blue_btn\",onClick:function onClick(){return setError(\"\");},children:\"Try again\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",ref:textRef,value:text,placeholder:\"Write a comment...\",onChange:function onChange(e){return setText(e.target.value);},onKeyUp:handleComment}),/*#__PURE__*/_jsx(\"div\",{className:\"comment_circle\",style:{marginTop:\"5px\"},children:/*#__PURE__*/_jsx(ClipLoader,{size:20,color:\"#1876f2\",loading:loading})}),/*#__PURE__*/_jsx(\"div\",{className:\"comment_circle_icon hover2\",onClick:function onClick(){setPicker(function(prev){return!prev;});},children:/*#__PURE__*/_jsx(\"i\",{className:\"emoji_icon\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"comment_circle_icon hover2\",onClick:function onClick(){return imgInput.current.click();},children:/*#__PURE__*/_jsx(\"i\",{className:\"camera_icon\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"comment_circle_icon hover2\",children:/*#__PURE__*/_jsx(\"i\",{className:\"gif_icon\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"comment_circle_icon hover2\",children:/*#__PURE__*/_jsx(\"i\",{className:\"sticker_icon\"})})]})]}),commentImage&&/*#__PURE__*/_jsxs(\"div\",{className:\"comment_img_preview\",children:[/*#__PURE__*/_jsx(\"img\",{src:commentImage,alt:\"\"}),/*#__PURE__*/_jsx(\"div\",{className:\"small_white_circle\",onClick:function onClick(){return setCommentImage(\"\");},children:/*#__PURE__*/_jsx(\"i\",{className:\"exit_icon\"})})]})]});}","map":{"version":3,"sources":["/Users/jasonaviles/Desktop/facebook/starter/frontendssmedia/src/components/post/CreateComment.js"],"names":["useEffect","useRef","useState","Picker","comment","uploadImages","dataURItoBlob","ClipLoader","CreateComment","user","postId","setComments","setCount","picker","setPicker","text","setText","error","setError","commentImage","setCommentImage","cursorPosition","setCursorPosition","loading","setLoading","textRef","imgInput","current","selectionEnd","handleEmoji","e","emoji","ref","focus","start","substring","selectionStart","end","newText","length","handleImage","file","target","files","type","name","size","reader","FileReader","readAsDataURL","onload","event","result","handleComment","key","img","path","username","formData","FormData","append","token","imgComment","url","comments","prev","picture","value","marginTop","click"],"mappings":"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","sourcesContent":["import { useEffect, useRef, useState } from \"react\";\r\nimport Picker from \"emoji-picker-react\";\r\nimport { comment } from \"../../functions/post\";\r\nimport { uploadImages } from \"../../functions/uploadImages\";\r\nimport dataURItoBlob from \"../../helpers/dataURItoBlob\";\r\nimport { ClipLoader } from \"react-spinners\";\r\nexport default function CreateComment({ user, postId, setComments, setCount }) {\r\n  const [picker, setPicker] = useState(false);\r\n  const [text, setText] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const [commentImage, setCommentImage] = useState(\"\");\r\n  const [cursorPosition, setCursorPosition] = useState();\r\n  const [loading, setLoading] = useState(false);\r\n  const textRef = useRef(null);\r\n  const imgInput = useRef(null);\r\n  useEffect(() => {\r\n    textRef.current.selectionEnd = cursorPosition;\r\n  }, [cursorPosition]);\r\n  const handleEmoji = (e, { emoji }) => {\r\n    const ref = textRef.current;\r\n    ref.focus();\r\n    const start = text.substring(0, ref.selectionStart);\r\n    const end = text.substring(ref.selectionStart);\r\n    const newText = start + emoji + end;\r\n    setText(newText);\r\n    setCursorPosition(start.length + emoji.length);\r\n  };\r\n  const handleImage = (e) => {\r\n    let file = e.target.files[0];\r\n    if (\r\n      file.type !== \"image/jpeg\" &&\r\n      file.type !== \"image/png\" &&\r\n      file.type !== \"image/webp\" &&\r\n      file.type !== \"image/gif\"\r\n    ) {\r\n      setError(`${file.name} format is not supported.`);\r\n      return;\r\n    } else if (file.size > 1024 * 1024 * 5) {\r\n      setError(`${file.name} is too large max 5mb allowed.`);\r\n      return;\r\n    }\r\n\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(file);\r\n    reader.onload = (event) => {\r\n      setCommentImage(event.target.result);\r\n    };\r\n  };\r\n  const handleComment = async (e) => {\r\n    if (e.key === \"Enter\") {\r\n      if (commentImage != \"\") {\r\n        setLoading(true);\r\n        const img = dataURItoBlob(commentImage);\r\n        const path = `${user.username}/post_images/${postId}`;\r\n        let formData = new FormData();\r\n        formData.append(\"path\", path);\r\n        formData.append(\"file\", img);\r\n        const imgComment = await uploadImages(formData, path, user.token);\r\n\r\n        const comments = await comment(\r\n          postId,\r\n          text,\r\n          imgComment[0].url,\r\n          user.token\r\n        );\r\n        setComments(comments);\r\n        setCount((prev) => ++prev);\r\n        setLoading(false);\r\n        setText(\"\");\r\n        setCommentImage(\"\");\r\n      } else {\r\n        setLoading(true);\r\n\r\n        const comments = await comment(postId, text, \"\", user.token);\r\n        setComments(comments);\r\n        setCount((prev) => ++prev);\r\n        setLoading(false);\r\n        setText(\"\");\r\n        setCommentImage(\"\");\r\n      }\r\n    }\r\n  };\r\n  return (\r\n    <div className=\"create_comment_wrap\">\r\n      <div className=\"create_comment\">\r\n        <img src={user?.picture} alt=\"\" />\r\n        <div className=\"comment_input_wrap\">\r\n          {picker && (\r\n            <div className=\"comment_emoji_picker\">\r\n              <Picker onEmojiClick={handleEmoji} />\r\n            </div>\r\n          )}\r\n          <input\r\n            type=\"file\"\r\n            hidden\r\n            ref={imgInput}\r\n            accept=\"image/jpeg,image/png,image/gif,image/webp\"\r\n            onChange={handleImage}\r\n          />\r\n          {error && (\r\n            <div className=\"postError comment_error\">\r\n              <div className=\"postError_error\">{error}</div>\r\n              <button className=\"blue_btn\" onClick={() => setError(\"\")}>\r\n                Try again\r\n              </button>\r\n            </div>\r\n          )}\r\n          <input\r\n            type=\"text\"\r\n            ref={textRef}\r\n            value={text}\r\n            placeholder=\"Write a comment...\"\r\n            onChange={(e) => setText(e.target.value)}\r\n            onKeyUp={handleComment}\r\n          />\r\n          <div className=\"comment_circle\" style={{ marginTop: \"5px\" }}>\r\n            <ClipLoader size={20} color=\"#1876f2\" loading={loading} />\r\n          </div>\r\n          <div\r\n            className=\"comment_circle_icon hover2\"\r\n            onClick={() => {\r\n              setPicker((prev) => !prev);\r\n            }}\r\n          >\r\n            <i className=\"emoji_icon\"></i>\r\n          </div>\r\n          <div\r\n            className=\"comment_circle_icon hover2\"\r\n            onClick={() => imgInput.current.click()}\r\n          >\r\n            <i className=\"camera_icon\"></i>\r\n          </div>\r\n          <div className=\"comment_circle_icon hover2\">\r\n            <i className=\"gif_icon\"></i>\r\n          </div>\r\n          <div className=\"comment_circle_icon hover2\">\r\n            <i className=\"sticker_icon\"></i>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {commentImage && (\r\n        <div className=\"comment_img_preview\">\r\n          <img src={commentImage} alt=\"\" />\r\n          <div\r\n            className=\"small_white_circle\"\r\n            onClick={() => setCommentImage(\"\")}\r\n          >\r\n            <i className=\"exit_icon\"></i>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}